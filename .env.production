# Otedama Production Configuration
# IMPORTANT: Keep this file secure and never commit to version control

# ===== NETWORK PORTS =====
API_PORT=8080
WS_PORT=8081
DEX_WS_PORT=8082
P2P_PORT=8333
P2P_DISCOVERY_PORT=8334

# ===== DATABASE =====
DB_PATH=./data/otedama.db
DB_READ_POOL_SIZE=20
DB_WRITE_POOL_SIZE=5
DB_MAX_CONNECTIONS=50
DB_CONNECTION_TIMEOUT=30000
DB_ENABLE_WAL=true
DB_CHECKPOINT_INTERVAL=300000  # 5 minutes

# ===== SYSTEM =====
NODE_ENV=production
LOG_LEVEL=warn
LOG_FILE_PATH=./logs/otedama.log
LOG_MAX_SIZE=104857600  # 100MB
LOG_MAX_FILES=10
MAX_WORKERS=0  # 0 = use all CPU cores
WORKER_RESTART_DELAY=5000

# ===== SECURITY =====
CORS_ORIGIN=https://otedama.io
CORS_CREDENTIALS=true
RATE_LIMIT_WINDOW=60000    # 1 minute
RATE_LIMIT_MAX=100         # requests per window
RATE_LIMIT_BURST=150       # burst allowance
SESSION_SECRET=CHANGE_THIS_TO_RANDOM_STRING_IN_PRODUCTION
JWT_SECRET=CHANGE_THIS_TO_RANDOM_STRING_IN_PRODUCTION
JWT_EXPIRY=86400000        # 24 hours
ENABLE_2FA=true
IP_WHITELIST_ENABLED=false
IP_BLACKLIST_ENABLED=true
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=900000    # 15 minutes

# ===== PERFORMANCE =====
CACHE_MAX_SIZE=536870912   # 512MB in bytes
CACHE_TTL=3600000         # 1 hour
GC_INTERVAL=3600000       # 1 hour
HTTP_TIMEOUT=30000        # 30 seconds
HTTP_KEEP_ALIVE_TIMEOUT=65000  # 65 seconds
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6

# Query Optimization
ENABLE_QUERY_CACHE=true    # Essential for production
QUERY_CACHE_SIZE=10000     # Number of queries to cache
QUERY_CACHE_TTL=300000     # 5 minutes
ENABLE_QUERY_BATCHING=true
QUERY_BATCH_SIZE=100
QUERY_BATCH_DELAY=10       # milliseconds

# Multi-Layer Cache
ENABLE_MULTI_LAYER_CACHE=true
L1_CACHE_MAX_SIZE=1000     # Number of items
L1_CACHE_MAX_MEMORY=104857600  # 100MB
L1_CACHE_TTL=300           # 5 minutes

# Redis Configuration (L2 Cache)
REDIS_ENABLED=true         # Highly recommended for production
REDIS_HOST=redis          # Use container name in Docker
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_THIS_TO_SECURE_PASSWORD
REDIS_DB=0
REDIS_KEY_PREFIX=otedama:
REDIS_CONNECTION_TIMEOUT=5000
REDIS_RETRY_ATTEMPTS=3

# Memory Management
ENABLE_MEMORY_PROFILER=false  # Has overhead, use only for debugging
ENABLE_OBJECT_POOLS=true      # Reduces GC pressure
BUFFER_POOL_SIZE=100
OBJECT_POOL_SIZE=1000
MEMORY_LEAK_DETECTION=false   # Enable only during testing

# Prometheus Metrics
ENABLE_PROMETHEUS_METRICS=true
METRICS_PORT=9090
METRICS_PATH=/metrics
METRICS_INCLUDE_DEFAULT=true
METRICS_BUCKETS=0.001,0.005,0.01,0.05,0.1,0.5,1,2,5

# ===== MINING POOL =====
POOL_FEE=0.01              # 1% fee
MIN_PAYOUT_BTC=0.001       # Minimum BTC payout
PAYOUT_INTERVAL=3600000    # 1 hour
SHARE_DIFFICULTY=65536     # Initial share difficulty
VARDIFF_ENABLED=true
VARDIFF_MIN=1024
VARDIFF_MAX=1048576
VARDIFF_TARGET_TIME=30     # seconds
VARDIFF_RETARGET_TIME=120  # seconds
BLOCK_NOTIFY_ENABLED=true

# ===== DEX =====
DEX_FEE_RATE=0.003         # 0.3% trading fee
DEX_MIN_ORDER_BTC=0.0001   # Minimum order size
DEX_MAX_ORDER_BTC=100      # Maximum order size
ORDER_BOOK_DEPTH=1000
MATCHING_ENGINE_WORKERS=4
SETTLEMENT_BATCH_SIZE=100
SETTLEMENT_INTERVAL=5000   # 5 seconds

# ===== DEFI =====
LIQUIDITY_FEE_RATE=0.003   # 0.3% LP fee
FLASH_LOAN_FEE=0.0009      # 0.09% flash loan fee
FLASH_LOAN_MAX_BTC=10      # Maximum flash loan size
YIELD_UPDATE_INTERVAL=300000  # 5 minutes
IMPERMANENT_LOSS_PROTECTION=true

# ===== EXTERNAL SERVICES =====
# API keys should be set via environment variables or secrets manager
COINMARKETCAP_API_KEY=
COINGECKO_API_KEY=
BINANCE_API_KEY=
BINANCE_API_SECRET=
PRICE_UPDATE_INTERVAL=60000   # 1 minute
API_RETRY_ATTEMPTS=3
API_RETRY_DELAY=5000

# ===== BACKUP =====
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 */6 * * *"  # Every 6 hours
BACKUP_RETENTION_DAYS=30
BACKUP_PATH=./backups
BACKUP_COMPRESSION=true
BACKUP_ENCRYPTION=true
BACKUP_CLOUD_ENABLED=false
BACKUP_CLOUD_PROVIDER=s3
BACKUP_CLOUD_BUCKET=

# ===== MONITORING =====
METRICS_ENABLED=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30000  # 30 seconds
HEALTH_CHECK_TIMEOUT=5000
ALERT_WEBHOOK_URL=
ALERT_EMAIL_ENABLED=false
ALERT_EMAIL_TO=
ALERT_EMAIL_FROM=
PROMETHEUS_ENABLED=true
GRAFANA_ENABLED=true

# ===== HIGH AVAILABILITY =====
CLUSTER_ENABLED=false
CLUSTER_NODE_ID=node1
CLUSTER_PEERS=
FAILOVER_ENABLED=true
FAILOVER_TIMEOUT=30000
LEADER_ELECTION_ENABLED=false

# ===== RESOURCE LIMITS =====
MAX_MEMORY_MB=4096
MAX_CPU_PERCENT=80
MAX_DISK_USAGE_PERCENT=90
MAX_OPEN_FILES=65536
MAX_CONCURRENT_CONNECTIONS=100000

# ===== FEATURE FLAGS =====
FEATURE_MINING_ENABLED=true
FEATURE_DEX_ENABLED=true
FEATURE_DEFI_ENABLED=true
FEATURE_API_V2_ENABLED=true
FEATURE_WEBSOCKET_ENABLED=true
FEATURE_P2P_ENABLED=true

# ===== MAINTENANCE MODE =====
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System maintenance in progress"
MAINTENANCE_ALLOWED_IPS=127.0.0.1